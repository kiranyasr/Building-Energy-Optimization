<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment | Energy Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/deployment.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <aside class="sidebar">
            <h1>Analysis Pipeline</h1>
            <nav>
    <ul>
        <li><a href="/">Upload Data</a></li>
        <li><a href="/clean">Clean & Preprocess</a></li>
        <li><a href="/fluctuations">Fluctuation Analysis</a></li>
        <li><a href="/features">Feature Engineering</a></li>
        <li><a href="/selection">Feature Selection</a></li>
        <li><a href="/models">Baseline Models</a></li>
        <li><a href="/deep_learning">Deep Learning</a></li>
        <li><a href="/optimization">Optimization</a></li>
        <li><a href="/anomalies">Anomaly Detection</a></li>
        <li><a href="/wastage">Wastage Analysis</a></li>
        <li><a href="/comparison">Final Report</a></li>
        <li class="active"><a href="/deployment">Deployment</a></li>
        <li><a href="/user_guide">User Guide</a></li> 
    </ul>
</nav>
        </aside>
        <main class="content-panel">
            <header>
                <h2>Model Deployment: Real-time Prediction</h2>
                <p>Use the final optimized model to predict energy consumption based on new inputs.</p>
            </header>
            
            <div class="prediction-container">
                <form id="prediction-form" class="prediction-form">
                    <h3>Input Features</h3>
                    <div class="form-grid">
                        {% for feature in features %}
                        <div class="form-group">
                            <label for="{{ feature }}">{{ feature }}</label>
                            <input type="number" step="any" id="{{ feature }}" name="{{ feature }}" placeholder="0.0" required>
                        </div>
                        {% else %}
                        <p class="error-message">Model not trained yet. Please complete the full pipeline from Day 1 to Day 8 to enable predictions.</p>
                        {% endfor %}
                    </div>
                    <button type="submit" class="action-btn" {% if not features %}disabled{% endif %}>
                        Predict Consumption
                        <div class="spinner"></div>
                    </button>
                </form>

                <div class="prediction-result-card">
                    <h3>Predicted Consumption</h3>
                    <div id="result-display" class="result-display">
                        <p class="placeholder">Prediction will appear here...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('prediction-form');
        const resultDisplay = document.getElementById('result-display');
        const predictBtn = form.querySelector('.action-btn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            setLoading(true);

            const formData = new FormData(form);
            const features = {};
            for (let [key, value] of formData.entries()) {
                features[key] = parseFloat(value);
            }

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ features: features })
                });
                const result = await response.json();
                
                if (!response.ok || result.error) { throw new Error(result.error); }

                resultDisplay.innerHTML = `<p class="prediction-value">${result.prediction} <span>kWh</span></p>`;

            } catch (error) {
                resultDisplay.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            } finally {
                setLoading(false);
            }
        });

        function setLoading(isLoading) {
            predictBtn.classList.toggle('loading', isLoading);
            predictBtn.disabled = isLoading;
        }
    });
    </script>
</body>
</html>